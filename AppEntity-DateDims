create or replace view APPLICATION_ENTITY_DB.PUBLIC.AE_DATEDIMS(
	DATE,
	DAYOFWEEK_NUMBER,
	DAYOFMONTH_NUMBER,
	DAYOFQUARTER_NUMBER,
	DAYOFYEAR_NUMBER,
	DAYOFWEEK_SHORTNAME,
	DAYOFWEEK_LONGNAME,
	IS_WEEKEND,
	WEEK_KEY,
	WEEKOFMONTH_NUMBER,
	WEEKOFQUARTER_NUMBER,
	WEEKOFYEAR_NUMBER,
	WEEK_START,
	WEEK_END,
	MONTH_KEY,
	MONTH_NUMBER,
	MONTH_SHORTNAME,
	MONTH_LONGNAME,
	MONTH_START,
	MONTH_END,
	QUARTER_KEY,
	QUARTER_NUMBER,
	QUARTER_NAME,
	QUARTER_START,
	QUARTER_END,
	YEAR_NUMBER
) COMMENT='Entity view of gregorian date dimensions'
 as
/*
* ---------------------------------------------------------------------------------------------------------
* Created       Created By          Description
* ---------------------------------------------------------------------------------------------------------
* 11/23/2022    Kevin Bailey        Initial creation
*/
WITH MAIN AS
(   SELECT   "DATE"
            ,DAYOFWEEK_NUMBER
            ,DAYOFMONTH_NUMBER
            ,ROW_NUMBER() OVER( PARTITION BY QUARTER_KEY
                                ORDER BY DATE ASC ) AS DAYOFQUARTER_NUMBER
            ,DAYOFYEAR_NUMBER
            ,DAYOFWEEK_SHORTNAME
            ,DAYOFWEEK_LONGNAME
            ,IS_WEEKEND
            ,WEEK_KEY
            ,WEEKOFMONTH_NUMBER
            ,WEEKOFYEAR_NUMBER
            ,WEEK_START
            ,WEEK_END
            ,MONTH_KEY
            ,MONTH_NUMBER
            ,MONTH_SHORTNAME
            ,MONTH_LONGNAME
            ,MONTH_START
            ,MONTH_END
            ,QUARTER_KEY
            ,QUARTER_NUMBER
            ,QUARTER_NAME
            ,QUARTER_START
            ,QUARTER_END
            ,YEAR_NUMBER
    FROM    TIDY_DB.PUBLIC.TIDY_DATEDIMS AS D ),
WEEKOFQUARTERCALC AS
(   SELECT   "DATE"
            ,CASE
                WHEN DAYOFQUARTER_NUMBER BETWEEN 1 AND 7 THEN 1
                WHEN DAYOFQUARTER_NUMBER BETWEEN 8 AND 14 THEN 2
                WHEN DAYOFQUARTER_NUMBER BETWEEN 15 AND 21 THEN 3
                WHEN DAYOFQUARTER_NUMBER BETWEEN 22 AND 28 THEN 4
                WHEN DAYOFQUARTER_NUMBER BETWEEN 29 AND 35 THEN 5
                WHEN DAYOFQUARTER_NUMBER BETWEEN 36 AND 42 THEN 6
                WHEN DAYOFQUARTER_NUMBER BETWEEN 43 AND 49 THEN 7
                WHEN DAYOFQUARTER_NUMBER BETWEEN 50 AND 56 THEN 8
                WHEN DAYOFQUARTER_NUMBER BETWEEN 57 AND 63 THEN 9
                WHEN DAYOFQUARTER_NUMBER BETWEEN 64 AND 70 THEN 10
                WHEN DAYOFQUARTER_NUMBER BETWEEN 71 AND 77 THEN 11
                WHEN DAYOFQUARTER_NUMBER BETWEEN 78 AND 84 THEN 12
                WHEN DAYOFQUARTER_NUMBER BETWEEN 85 AND 91 THEN 13
                WHEN DAYOFQUARTER_NUMBER BETWEEN 92 AND 98 THEN 14                
             END AS WEEKOFQUARTER_NUMBER
    FROM    MAIN AS M
)
SELECT   M."DATE"
        ,M.DAYOFWEEK_NUMBER
        ,M.DAYOFMONTH_NUMBER
        ,M.DAYOFQUARTER_NUMBER
        ,M.DAYOFYEAR_NUMBER
        ,M.DAYOFWEEK_SHORTNAME
        ,M.DAYOFWEEK_LONGNAME
        ,M.IS_WEEKEND
        ,M.WEEK_KEY
        ,M.WEEKOFMONTH_NUMBER
        ,Q.WEEKOFQUARTER_NUMBER
        ,M.WEEKOFYEAR_NUMBER
        ,M.WEEK_START
        ,M.WEEK_END
        ,M.MONTH_KEY
        ,M.MONTH_NUMBER
        ,M.MONTH_SHORTNAME
        ,M.MONTH_LONGNAME
        ,M.MONTH_START
        ,M.MONTH_END
        ,M.QUARTER_KEY
        ,M.QUARTER_NUMBER
        ,M.QUARTER_NAME
        ,M.QUARTER_START
        ,M.QUARTER_END
        ,M.YEAR_NUMBER
FROM    MAIN AS M INNER JOIN WEEKOFQUARTERCALC AS Q ON M."DATE" = Q."DATE";
